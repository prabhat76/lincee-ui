<div class="admin-page">
  <div class="container">
    <div class="admin-header">
      <h1>Admin Console</h1>
      <p>Manage products and update orders.</p>
    </div>

    <div class="error" *ngIf="error()">{{ error() }}</div>

    <section class="admin-section">
      <div class="section-header">
        <h2>Shop Items</h2>
      </div>

      <div class="table" *ngIf="!loadingShopItems()">
        <div class="table-header">
          <span>ID</span>
          <span>Name</span>
          <span>Price</span>
          <span>Category</span>
          <span>Stock Status</span>
        </div>
        <div class="table-row" *ngFor="let item of shopItems()">
          <span>#{{ item.id }}</span>
          <span>{{ item.name }}</span>
          <span>{{ item.price | currency }}</span>
          <span>{{ item.category }}</span>
          <span class="stock-status">In Stock</span>
        </div>
        <div class="empty-state" *ngIf="shopItems().length === 0">
          <p>No items in shop. Add products to see them here.</p>
        </div>
      </div>
      <div class="loading" *ngIf="loadingShopItems()">Loading shop items...</div>
    </section>

    <section class="admin-section">
      <div class="section-header">
        <h2>Products</h2>
      </div>

      <!-- Excel Import Section -->
      <div class="excel-import-toggle">
        <button type="button" class="btn btn-secondary" (click)="showExcelImport.set(!showExcelImport())">
          {{ showExcelImport() ? 'ðŸ“Š Hide Bulk Import' : 'ðŸ“Š Show Bulk Import' }}
        </button>
      </div>

      <app-excel-import 
        *ngIf="showExcelImport()"
        (productImported)="onProductImported($event)">
      </app-excel-import>

      <form [formGroup]="productForm" (ngSubmit)="submitProduct()" class="product-form">
        <div class="form-row">
          <input formControlName="name" placeholder="Product name" />
          <input formControlName="price" type="number" placeholder="Price" />
        </div>
        <div class="form-row">
          <input formControlName="category" placeholder="Category" />
          <input formControlName="imageUrl" placeholder="Image URL (or use upload below)" />
        </div>
        <textarea formControlName="description" rows="3" placeholder="Description"></textarea>

        <!-- Image Upload Component -->
        <div class="image-upload-section">
          <button type="button" class="btn btn-secondary" (click)="showImageUpload.set(!showImageUpload())">
            {{ showImageUpload() ? 'Hide Image Upload' : 'Show Image Upload' }}
          </button>
          <app-product-image-upload 
            *ngIf="showImageUpload()"
            (imagesSelected)="onImagesSelected($event)">
          </app-product-image-upload>
        </div>

        <div class="form-actions">
          <button class="btn btn-primary" type="submit">Save Product</button>
          <button class="btn btn-secondary" type="button" (click)="showImageUpload.set(false); selectedProductImages.set([]); productForm.reset({ id: null, name: '', price: 0, description: '', category: '', imageUrl: '' })">
            Clear
          </button>
        </div>
      </form>

      <div class="table" *ngIf="!loadingProducts()">
        <div class="table-header">
          <span>Name</span>
          <span>Price</span>
          <span>Category</span>
          <span>Actions</span>
        </div>
        <div class="table-row" *ngFor="let product of getDisplayedProducts()">
          <span>{{ product.name }}</span>
          <span>{{ product.price | currency }}</span>
          <span>{{ product.category }}</span>
          <div class="row-actions">
            <button class="btn-text" (click)="editProduct(product)">Edit</button>
            <button class="btn-text danger" (click)="deleteProduct(product.id)">Delete</button>
          </div>
        </div>
        <div class="empty-state" *ngIf="products().length === 0">
          <p>No products available. Create your first product above.</p>
        </div>
      </div>
      <div class="empty-state" *ngIf="!loadingProducts() && products().length === 0">
        <p>No products available. Create your first product above.</p>
      </div>
      <div class="loading" *ngIf="loadingProducts()">Loading products...</div>

      <div class="show-all-container" *ngIf="products().length > 5">
        <button class="btn btn-secondary" (click)="toggleShowAllProducts()">
          {{ showAllProducts() ? 'Show Less' : 'Show All Products' }} ({{ products().length }} total)
        </button>
      </div>
    </section>

    <section class="admin-section">
      <div class="section-header">
        <h2>Orders</h2>
        <div class="filter">
          <label for="status">Status</label>
          <select id="status" [value]="statusFilter()" (change)="onStatusFilterChange($any($event.target).value)">
            <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
          </select>
        </div>
      </div>

      <div class="table" *ngIf="!loadingOrders()">
        <div class="table-header">
          <span>Order</span>
          <span>Items</span>
          <span>Status</span>
          <span>Update</span>
        </div>
        <div class="table-row" *ngFor="let order of orders()">
          <span>#{{ order.id }}</span>
          <span>{{ getOrderItems(order).length }} item(s)</span>
          <span class="status">{{ order.status }}</span>
          <div class="row-actions">
            <select #nextStatus>
              <option value="" disabled selected>-- Select status --</option>
              <option *ngFor="let status of getValidNextStatuses(order)" [value]="status">{{ status }}</option>
            </select>
            <input #trackingNumber class="tracking-input" placeholder="Tracking # (optional)" />
            <button class="btn-text" (click)="updateOrderStatus(order, nextStatus.value, trackingNumber.value)">Update</button>
          </div>
        </div>
        <div class="empty-state" *ngIf="orders().length === 0">
          <p>No orders found. Orders will appear here once customers place them.</p>
        </div>
      </div>
      <div class="empty-state" *ngIf="!loadingOrders() && orders().length === 0">
        <p>No orders found. Orders will appear here once customers place them.</p>
      </div>
      <div class="loading" *ngIf="loadingOrders()">Loading orders...</div>
    </section>
  </div>
</div>
