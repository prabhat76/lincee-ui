<div class="product-details-page" *ngIf="loading()">
    <div class="container loading">
        Loading product...
    </div>
</div>

<div class="product-details-page" *ngIf="!loading() && product() as p">
    <div class="container">
        <div class="product-grid">
            <div class="product-gallery" [class.has-hover-image]="getHoverImage(p)">
                <img
                    class="product-gallery__primary"
                    [src]="getPrimaryImage(p)"
                    [alt]="p.name"
                    (error)="handleImageError($event)"
                >
                <img
                    *ngIf="getHoverImage(p) as hoverImage"
                    class="product-gallery__hover"
                    [src]="hoverImage"
                    [alt]="p.name + ' lifestyle'"
                    (error)="handleImageError($event)"
                >
            </div>
            
            <div class="product-info">
                <h1 class="product-title">{{ p.name }}</h1>
                <p class="product-price">{{ p.price | currency }}</p>
                <div class="product-description">
                    <p>{{ p.description }}</p>
                </div>

                <div class="product-options">
                    <div class="option-group">
                        <label>Size</label>
                        <div class="option-buttons">
                            <button *ngFor="let s of sizes" 
                                    [class.active]="selectedSize() === s"
                                    (click)="selectSize(s)">
                                {{ s }}
                            </button>
                        </div>
                    </div>

                    <div class="option-group">
                        <label>Color</label>
                        <div class="option-buttons">
                            <button *ngFor="let c of colors" 
                                    [class.active]="selectedColor() === c"
                                    (click)="selectColor(c)">
                                {{ c }}
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-actions">
                    <button class="btn-add-cart" (click)="addToCart()" [disabled]="addingToCart()">
                        <span *ngIf="!addingToCart()">{{ getQuantity() > 0 ? 'ADD ANOTHER' : 'ADD TO CART' }}</span>
                        <span *ngIf="addingToCart()">ADDING...</span>
                    </button>

                    <button class="btn-buy-now" (click)="buyNow()" [disabled]="addingToCart()">
                        <span *ngIf="!addingToCart()">BUY NOW</span>
                        <span *ngIf="addingToCart()">PROCESSING...</span>
                    </button>

                    <div class="quantity-controls" *ngIf="getQuantity() > 0">
                        <button class="btn-qty" (click)="decreaseQuantity()" [disabled]="addingToCart()">âˆ’</button>
                        <span class="qty-display">In cart: {{ getQuantity() }}</span>
                        <button class="btn-qty" (click)="increaseQuantity()" [disabled]="addingToCart()">+</button>
                    </div>
                    <p class="message" *ngIf="message()" [class.error]="message().includes('Failed')">
                        {{ message() }}
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="product-details-page" *ngIf="!loading() && !product()">
    <div class="container error">
        Product not found. <a routerLink="/">Go Back</a>
    </div>
</div>
